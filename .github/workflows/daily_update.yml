name: Daily Data Update

on:
  schedule:
    - cron: '0 3 * * *'  # æ¯å¤©å°ç£æ™‚é–“æ—©ä¸Š 9:00
  workflow_dispatch:      # å…è¨±æ‰‹å‹•è§¸ç™¼

jobs:
  update-data:
    runs-on: ubuntu-latest
    # çµ¦äºˆå¯«å…¥æ¬Šé™
    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install gspread oauth2client pandas requests numpy

      - name: Run Wiki Update
        env:
          GCP_SERVICE_ACCOUNT_JSON: ${{ secrets.GCP_SERVICE_ACCOUNT_JSON }}
        run: python app_wiki.py

      - name: Run YouTube Update & Generate JSON
        env:
          GCP_SERVICE_ACCOUNT_JSON: ${{ secrets.GCP_SERVICE_ACCOUNT_JSON }}
          YOUTUBE_API_KEY: ${{ secrets.YOUTUBE_API_KEY }}
        run: python app_yt.py 1

      # ğŸš€ æ–°å¢ï¼šå°‡ç”¢ç”Ÿçš„ JSON æ¨é€åˆ° GitHub å€‰åº«
      - name: Commit and Push JSON API
        run: |
          git config --global user.name "GitHub Action Bot"
          git config --global user.email "actions@github.com"
          git add latest_risk.json
          git commit -m "ğŸ¤– è‡ªå‹•æ›´æ–° API æ•¸æ“š: $(date +'%Y-%m-%d %H:%M')" || echo "ç„¡è®Šæ›´éœ€è¦æäº¤"
          git push
